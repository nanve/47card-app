<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚«ãƒ¼ãƒ‰èªè­˜ãƒ†ã‚¹ãƒˆï¼ˆæ•°å­—ã‚³ãƒ¼ãƒ‰ï¼‰</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
<style>
Â  body { font-family: sans-serif; text-align: center; margin: 20px; }
Â  video, #result { 
Â Â Â  width: 100%; 
Â Â Â  max-width: 400px; 
Â Â Â  height: auto; 
Â Â Â  margin: 10px auto; 
Â Â Â  border: 1px solid #ccc;
Â Â Â  display: block;
Â  }
Â  #canvas { display: none; }
Â  button { padding: 10px 15px; margin: 5px; cursor: pointer; }
Â  #result { border: 1px solid #007bff; padding: 15px; text-align: left; }
</style>
</head>
<body>
<h2>ğŸ”¢ ã‚«ãƒ¼ãƒ‰èªè­˜ãƒ†ã‚¹ãƒˆï¼ˆæœ€çµ‚èª¿æ•´ï¼‰</h2>

<video id="video" autoplay playsinline></video><br>
<button id="startCamera">ã‚«ãƒ¡ãƒ©èµ·å‹•</button>
<button id="capture" disabled>æ’®å½±ã—ã¦èªè­˜</button>
<canvas id="canvas"></canvas>

<div id="result">èªè­˜çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const resultDiv = document.getElementById('result');
const captureButton = document.getElementById('capture');
const startCameraButton = document.getElementById('startCamera');

// ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿è¾æ›¸
const cardLinks = {
Â  "001": "https://3bonya.com/47/2025/11/25/hello-world/"
};

// 1. ã‚«ãƒ¡ãƒ©èµ·å‹•ï¼ˆã‚¢ã‚¦ãƒˆã‚«ãƒ¡ãƒ©å„ªå…ˆè¨­å®šã‚’é©ç”¨ï¼‰
startCameraButton.addEventListener('click', async () => {
Â  resultDiv.innerHTML = "ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ä¸­...";
Â  try {
Â  Â  const constraints = { video: { facingMode: "environment" } };
Â  Â  const stream = await navigator.mediaDevices.getUserMedia(constraints);
Â  Â  if (video.srcObject) { video.srcObject.getTracks().forEach(track => track.stop()); }
Â  Â  video.srcObject = stream;
Â  Â  captureButton.disabled = false;
Â  Â  resultDiv.innerHTML = "ã‚«ãƒ¡ãƒ©èµ·å‹•æˆåŠŸã€‚ã‚«ãƒ¼ãƒ‰ã®**001**ã‚’ç”»é¢ã„ã£ã±ã„ã«å¤§ããå†™ã—ã¦ãã ã•ã„ã€‚";
Â  } catch (err) {
Â  Â  resultDiv.innerHTML = `<p style="color:red;">ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚¨ãƒ©ãƒ¼: ${err.message}</p>`;
Â  }
});

// 2. æ’®å½±ï¼†èªè­˜
captureButton.addEventListener('click', async () => {
Â  if (!video.srcObject) { alert("å…ˆã«ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã—ã¦ãã ã•ã„ã€‚"); return; }
Â  
Â  resultDiv.innerHTML = "æ’®å½±ã—ã¦æ–‡å­—èªè­˜å‡¦ç†ä¸­...ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚";
Â  captureButton.disabled = true; 
Â  
Â  // æ’®å½±å‡¦ç†
Â  canvas.width = video.videoWidth;
Â  canvas.height = video.videoHeight;
Â  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
Â  
Â  // ------------------------------------------------
Â  
Â  try {
Â  Â  // ğŸš¨ æœ€çµ‚èª¿æ•´: OCRãƒ¢ãƒ¼ãƒ‰ã‚’è‹±èª ('eng') ã«å¤‰æ›´ã—ã€æ•°å­—ã®ã¿ã«é™å®š ğŸš¨
Â  Â  const { data: { text } } = await Tesseract.recognize(canvas, 'eng', { 
Â  Â  Â  tessedit_char_whitelist: '0123456789' // èªè­˜å¯¾è±¡ã‚’æ•°å­—ã®ã¿ã«é™å®š
Â  Â  }); 

Â  Â  // èªè­˜æ–‡å­—ã‹ã‚‰ç©ºç™½æ–‡å­—ã€æ”¹è¡Œã€ãŠã‚ˆã³æ•°å­—ä»¥å¤–ã®æ–‡å­—ã‚’ã™ã¹ã¦é™¤å»
Â  Â  const recognizedText = text.trim().replace(/\s/g, '').replace('\n', '').replace(/[^0-9]/g, '');
Â  Â  console.log("èªè­˜æ–‡å­—:", recognizedText);

Â  Â  // 2-2. çµæœã®è¡¨ç¤ºã¨è¾æ›¸æ¤œç´¢
Â  Â  let outputHTML;
Â  Â  if (cardLinks[recognizedText]) {
Â  Â  Â  outputHTML = `<p>èªè­˜çµæœ: **${recognizedText}**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="${cardLinks[recognizedText]}" target="_blank">âœ… **${recognizedText}** ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’è¦‹ã‚‹</a>`;
Â  Â  } else {
Â  Â  Â  outputHTML = `<p>èªè­˜çµæœ: **${recognizedText}**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="color:orange;">è©²å½“ã‚«ãƒ¼ãƒ‰ **${recognizedText}** ãŒè¾æ›¸ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p>ãƒ’ãƒ³ãƒˆï¼šæ–‡å­—ãŒç”»é¢ã„ã£ã±ã„ã«å¤§ããã€ãƒ”ãƒ³ãƒˆãŒåˆã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>`;
Â  Â  }
Â  Â  
Â  Â  resultDiv.innerHTML = outputHTML;

Â  } catch (ocrErr) {
Â  Â  resultDiv.innerHTML = `<p style="color:red;">èªè­˜å‡¦ç†ã‚¨ãƒ©ãƒ¼: Tesseract.jsã®å®Ÿè¡Œä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</p>`;
Â  Â  console.error(ocrErr);
Â  }
Â  
Â  captureButton.disabled = false;
});
</script>
</body>
</html>