<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚ªãƒ©ã‚¯ãƒ«ã‚«ãƒ¼ãƒ‰èªè­˜ï¼ˆæ–‡å­—ã®ã¿ï¼‰</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
<style>
Â  body { font-family: sans-serif; text-align: center; margin: 20px; }
Â  /* videoã¨resultã¯å¹…ã‚’èª¿æ•´ */
Â  video, #result { 
Â Â Â  width: 100%; 
Â Â Â  max-width: 400px; /* è¦‹ã‚„ã™ã„æœ€å¤§å¹… */
Â Â Â  height: auto; 
Â Â Â  margin: 10px auto; 
Â Â Â  border: 1px solid #ccc;
Â Â Â  display: block;
Â  }
Â  #canvas { display: none; }
Â  button { padding: 10px 15px; margin: 5px; cursor: pointer; }
Â  #result { border: 1px solid #007bff; padding: 15px; text-align: left; }
</style>
</head>
<body>
<h2>ğŸ“ ã‚«ãƒ¼ãƒ‰èªè­˜ãƒ†ã‚¹ãƒˆï¼ˆæ–‡å­—ã®ã¿ï¼‰</h2>

<video id="video" autoplay playsinline></video><br>
<button id="startCamera">ã‚«ãƒ¡ãƒ©èµ·å‹•</button>
<button id="capture" disabled>æ’®å½±ã—ã¦èªè­˜</button>
<canvas id="canvas"></canvas>

<div id="result">èªè­˜çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const resultDiv = document.getElementById('result');
const captureButton = document.getElementById('capture');
const startCameraButton = document.getElementById('startCamera');

// ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿è¾æ›¸ - ã‚­ãƒ¼ã‚’èªè­˜æ–‡å­—ã®ã¿ã«ä¿®æ­£
const cardLinks = {
Â  "é™½å…‰": "https://3bonya.com/47/2025/11/25/hello-world/" // èªè­˜æ–‡å­— "é™½å…‰" ã®ã¿
};

// 1. ã‚«ãƒ¡ãƒ©èµ·å‹•ï¼ˆã‚¢ã‚¦ãƒˆã‚«ãƒ¡ãƒ©å„ªå…ˆè¨­å®šã‚’é©ç”¨ï¼‰
startCameraButton.addEventListener('click', async () => {
Â  resultDiv.innerHTML = "ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ä¸­...";
Â  try {
Â  Â  // ã‚¢ã‚¦ãƒˆã‚«ãƒ¡ãƒ©ï¼ˆèƒŒé¢ã‚«ãƒ¡ãƒ©ï¼‰ã‚’å„ªå…ˆã™ã‚‹è¨­å®š
Â  Â  const constraints = {
Â  Â  Â  video: {
Â  Â  Â  Â  facingMode: "environment" 
Â  Â  Â  }
Â  Â  };
Â  Â  
Â  Â  const stream = await navigator.mediaDevices.getUserMedia(constraints);
Â  Â  // æ—¢ã«èµ·å‹•ä¸­ã®ã‚«ãƒ¡ãƒ©ãŒã‚ã‚Œã°ãƒˆãƒ©ãƒƒã‚¯ã‚’åœæ­¢ã—ã¦ã‹ã‚‰æ–°ã—ã„ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’ã‚»ãƒƒãƒˆ
Â  Â  if (video.srcObject) {
Â  Â  Â  video.srcObject.getTracks().forEach(track => track.stop());
Â  Â  }
Â  Â  video.srcObject = stream;
Â  Â  captureButton.disabled = false; // èµ·å‹•ã—ãŸã‚‰æ’®å½±ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
Â  Â  resultDiv.innerHTML = "ã‚«ãƒ¡ãƒ©èµ·å‹•æˆåŠŸã€‚ã‚«ãƒ¼ãƒ‰ã‚’æ’®å½±ã‚¨ãƒªã‚¢ã«å…¥ã‚Œã¦ãã ã•ã„ã€‚";
Â  } catch (err) {
Â  Â  alert("ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚¨ãƒ©ãƒ¼: " + err.message + "ã€‚ã‚«ãƒ¡ãƒ©ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
Â  Â  resultDiv.innerHTML = `<p style="color:red;">ã‚«ãƒ¡ãƒ©èµ·å‹•ã‚¨ãƒ©ãƒ¼: ${err.message}</p>`;
Â  }
});

// 2. æ’®å½±ï¼†èªè­˜
captureButton.addEventListener('click', async () => {
Â  if (!video.srcObject) {
Â Â Â  alert("å…ˆã«ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã—ã¦ãã ã•ã„ã€‚");
Â Â Â  return;
Â  }
Â  
Â  resultDiv.innerHTML = "æ’®å½±ã—ã¦æ–‡å­—èªè­˜å‡¦ç†ä¸­...ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚";
Â  captureButton.disabled = true; // å‡¦ç†ä¸­ã¯ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
Â  
Â  // æ’®å½±å‡¦ç†
Â  canvas.width = video.videoWidth;
Â  canvas.height = video.videoHeight;
Â  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

Â  try {
Â  Â  // 2-1. OCRå®Ÿè¡Œ
Â  Â  const { data: { text } } = await Tesseract.recognize(canvas, 'jpn');
Â  Â  // èªè­˜æ–‡å­—ã‹ã‚‰ç©ºç™½æ–‡å­—ã‚’ã™ã¹ã¦é™¤å»ã—ã€è¾æ›¸ã®ã‚­ãƒ¼ã¨ã—ã¦ä½¿ç”¨
Â  Â  const recognizedText = text.trim().replace(/\s/g, ''); 
Â  Â  console.log("èªè­˜æ–‡å­—:", recognizedText);

Â  Â  // 2-2. çµæœã®è¡¨ç¤ºã¨è¾æ›¸æ¤œç´¢
Â  Â  let outputHTML;
Â  Â  if (cardLinks[recognizedText]) {
Â  Â  Â  // ã‚«ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆ
Â  Â  Â  outputHTML = `<p>èªè­˜çµæœ: **${recognizedText}**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="${cardLinks[recognizedText]}" target="_blank">âœ… **${recognizedText}** ã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’è¦‹ã‚‹</a>`;
Â  Â  } else {
Â  Â  Â  // ã‚«ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸå ´åˆ
Â  Â  Â  outputHTML = `<p>èªè­˜çµæœ: **${recognizedText}**</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p style="color:orange;">è©²å½“ã‚«ãƒ¼ãƒ‰ **${recognizedText}** ãŒè¾æ›¸ã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</p>`;
Â  Â  }
Â  Â  
Â  Â  resultDiv.innerHTML = outputHTML;

Â  } catch (ocrErr) {
Â  Â  resultDiv.innerHTML = `<p style="color:red;">èªè­˜å‡¦ç†ã‚¨ãƒ©ãƒ¼: Tesseract.jsã®å®Ÿè¡Œä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚</p>`;
Â  Â  console.error(ocrErr);
Â  }
Â  
Â  captureButton.disabled = false; // å‡¦ç†å®Œäº†å¾Œã«ãƒœã‚¿ãƒ³ã‚’å†åº¦æœ‰åŠ¹åŒ–
});
</script>
</body>
</html>